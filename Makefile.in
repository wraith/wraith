#
#  This is the Makefile for EGGDROP (the IRC bot)
#  You should never need to edit this.
#

SHELL = @SHELL@
top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@
prefix = @prefix@
EGGVERSION = @EGGVERSION@
LEAFEXEC = leaf
HUBEXEC = hub

# things you can put here:
#   -Wall            if you're using gcc and it supports it
#                    (configure usually detects this anyway now)
#
#   -DDEBUG_ASSERT   to enable assert debugging
#   -DDEBUG_MEM      to be able to debug memory allocation (.debug)
#                    These can both be set by using 'make debug'
#                    or 'make sdebug'
CFLGS = 

# configure SHOULD set these...you may need to tweak them to get modules
# to compile .. if you do...let the devel-team know the working settings
# btw to turn STRIP off, do 'STRIP = touch' not 'STRIP ='

# defaults
CC = @CC@
LD = @CC@
STRIP = @STRIP@

# STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP #
# - - - - - - - - do not edit anything below this line. - - - - - - - - #
# - - - - - - - - -  it's all done by configure now.  - - - - - - - - - #
# STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP STOP #

# stuff for Tcl
XREQS = @TCL_REQS@
XLIBS = @TCL_LIBS@ @LIBS@ @ZLIB@ @SSL@
TCLLIB = @TCLLIB@
TCLLIBFN = @TCLLIBFN@

modconf = $(top_srcdir)/misc/modconfig --top_srcdir=$(top_srcdir)

post_iconfig =  $(modconf) update-depends && \
		$(modconf) Makefile && \
		(cd src/mod && $(MAKE_CONFIG) config) && \
		$(modconf) Makefile

egg_install_msg =  echo "" && \
		   echo "Now run \"make install\" to install your bot." && \
		   echo ""

DEBCFLAGS = -DDEBUG_ASSERT -DDEBUG_MEM

MAKE_LEAF = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' \
'STRIP=$(STRIP)' 'CFLGS=$(CFLGS) -DLEAF' \
'TCLLIB=$(TCLLIB)' 'TCLLIBFN=$(TCLLIBFN)' 'XREQS=$(XREQS)' \
'XLIBS=$(XLIBS)' 'EGGEXEC=$(LEAFEXEC)' 'EGGBUILD=(leaf)' \
'MODOBJS=mod/*.o' 

MAKE_DLEAF = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD) -g' \
'STRIP=touch' 'CFLGS=-g3 $(DEBCFLAGS) -DLEAF $(CFLGS)' \
'TCLLIB=$(TCLLIB)' 'TCLLIBFN=$(TCLLIBFN)' 'XREQS=$(XREQS)' 'XLIBS=$(XLIBS)' \
'EGGEXEC=$(LEAFEXEC)' 'EGGBUILD=(debug leaf)' 'MODOBJS=mod/*.o'

MAKE_HUB = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' \
'STRIP=$(STRIP)' 'CFLGS=$(CFLGS) -DHUB' \
'TCLLIB=$(TCLLIB)' 'TCLLIBFN=$(TCLLIBFN)' 'XREQS=$(XREQS)' \
'XLIBS=$(XLIBS)' 'EGGEXEC=$(HUBEXEC)' 'EGGBUILD=(hub)' \
'MODOBJS=mod/*.o'

MAKE_DHUB = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD) -g' \
'STRIP=touch' 'CFLGS=-g3 $(DEBCFLAGS) -DHUB $(CFLGS)' \
'TCLLIB=$(TCLLIB)' 'TCLLIBFN=$(TCLLIBFN)' 'XREQS=$(XREQS)' 'XLIBS=$(XLIBS)' \
'EGGEXEC=$(HUBEXEC)' 'EGGBUILD=(debug hub)' 'MODOBJS=mod/*.o'

MAKE_UTILS = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'STRIP=$(STRIP)' \
'CFLGS=$(CFLGS)' 'XREQS=$(XREQS)' \
'XLIBS=$(XLIBS)' 'LD=$(LD)'

MAKE_DEPEND = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' \
'STRIP=$(STRIP)' 'CFLGS=$(CFLGS)'

MAKE_CONFIG = $(MAKE) 'MAKE=$(MAKE)'

all:
	@echo ""
	@echo "Use the build script doofus."
	@echo ""

cleanutils:
	@rm -f stringfix
	@misc/dostrings l

clean:  cleanutils
	@cd src && $(MAKE) clean
	@cd src/compat && $(MAKE) clean
	@rm -f $(HUBEXEC) $(LEAFEXEC) *.stamp core DEBUG *~ key configure.temp makesalt makesettings
	@rm -f $(HUBEXEC).* $(LEAFEXEC).* src/makesalt src/makesettings src/settings.c src/settings.tmp

distclean: clean clean-modconfig
	@cd src/mod && $(MAKE) distclean
	@rm -f Makefile src/Makefile src/compat/Makefile src/mod/Makefile
	@rm -f config.cache config.log config.status config.h lush.h stamp.*
	@rm -rf autom4te.cache


distrib: distclean
	@rm -f `find . \( -name '*~' -o -name '*#' -o -name '*.orig' -o -name '*.rej' -o -name '*.bak' \) -print`
	@rm -rf `find . \( -name 'CVS' \) -print`

depend:
#	@cat /dev/null > lush.h
	@cd src && $(MAKE_DEPEND) depend
	@cd src/mod && $(MAKE_DEPEND) depend
	@cd src/compat && $(MAKE_DEPEND) depend

eggautoconf:
	@$(modconf) eggautoconf

packconf: utils
	@./makesettings pack/pack.cfg src/settings.tmp
	@(if test "x`diff -urN src/settings.tmp src/settings.c`" != "x"; then \
	cp -f src/settings.tmp src/settings.c; \
	fi)
#	@cp -fu pack/settings.c src/settings.c

salt:	utils
	@./makesalt

config:
	@$(modconf) modules-still-exist
	@$(modconf) detect-modules
	@$(modconf) update-depends
	@$(modconf) Makefile
	@cd src/mod && $(MAKE_CONFIG) config
	@$(modconf) Makefile

clean-modconfig:
	@rm -f .modules .known_modules

reconfig: clean-modconfig config

utils:  
	@cd src && $(MAKE_UTILS) ../stringfix
	@misc/dostrings
	@cd src && $(MAKE_UTILS) ../makesalt
	@cd src && $(MAKE_UTILS) ../makesettings

depleaf:
	@cd src && $(MAKE_DEPEND) depleaf
	@cd src/mod && $(MAKE_DEPEND) depleaf
	@cd src/compat && $(MAKE_DEPEND) depleaf

dephub:
	@cd src && $(MAKE_DEPEND) dephub
	@cd src/mod && $(MAKE_DEPEND) dephub
	@cd src/compat && $(MAKE_DEPEND) dephub


leaf:	utils salt config packconf
	@echo ""
	@echo "Making leaf"
	@echo ""
	@rm -f src/mod/mod.xlibs
	@./misc/maketype leaf
	@echo ""
	@cd src/mod && $(MAKE_LEAF) static
	@echo ""
	@cd src && $(MAKE_LEAF) $(LEAFEXEC)
	@echo ""

dleaf:  utils salt config packconf
	@echo ""
	@echo "Making debug leaf"
	@echo ""
	@rm -f src/mod/mod.xlibs
	@./misc/maketype leaf
	@echo ""
	@cd src/mod && $(MAKE_DLEAF) static
	@echo ""
	@cd src && $(MAKE_DLEAF) $(LEAFEXEC)
	@echo ""

hub:	utils salt config packconf
	@echo ""
	@echo "Making hub"
	@echo ""
	@rm -f src/mod/mod.xlibs
	@rm -f src/mod/mod.xlibs
	@./misc/maketype hub
	@echo ""
	@cd src/mod && $(MAKE_HUB) static
	@echo ""
	@cd src && $(MAKE_HUB) $(HUBEXEC)
	@echo ""

dhub:   utils salt config packconf
	@echo ""
	@echo "Making debug hub"
	@echo ""
	@rm -f src/mod/mod.xlibs
	@./misc/maketype hub
	@echo ""
	@cd src/mod && $(MAKE_DHUB) static
	@echo ""
	@cd src && $(MAKE_DHUB) $(HUBEXEC)
	@echo ""

#safety hash

