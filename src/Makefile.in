# Makefile for src/

SHELL = @SHELL@
top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@
depcomp = /bin/sh $(top_srcdir)/autotools/depcomp

@SET_MAKE@

CC = @CC@
LD = @CC@
STRIP = @STRIP@
CFLAGS = @CFLAGS@ -I.. -I$(top_srcdir) -I$(top_srcdir)/pack @DEFS@ $(CFLGS)
CPPFLAGS = @CPPFLAGS@

eggdrop_objs 		= auth.o \
			bg.o \
			botcmd.o \
			botmsg.o \
			botnet.o \
			chanprog.o \
			cmds.o \
			config.o \
			core_binds.o \
			crypt.o \
			dcc.o \
			dccutil.o \
			debug.o \
			dns.o \
			egg_timer.o \
			flags.o \
			main.o \
			mem.o \
			misc.o \
			misc_file.o \
			modules.o \
			net.o \
			rfc1459.o \
			settings.o \
			tcl.o \
			tclhash.o \
			userent.o \
			userrec.o \
			users.o

MAKE_GENERIC = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' 'STRIP=$(STRIP)' 'CFLGS=$(CFLGS)'

blah:
	@echo ""
	@echo "Use the build script."
	@echo ""

makehelp: makehelp.c
	@echo -e "Compiling: \033[1mmakehelp\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) makehelp.c -o makehelp
	@$(STRIP) makehelp

sorthelp: sorthelp.c
	@echo -e "Compiling: \033[1msorthelp\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) sorthelp.c -o sorthelp
	@$(STRIP) sorthelp

makesettings: makesettings.c
	@echo -e "Compiling: \033[1mmakesettings\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) makesettings.c -o makesettings
	@$(STRIP) makesettings

stringfix: stringfix.c main.h ../config.h ../pack/pack.cfg eggdrop.h
	@echo -e "Compiling: \033[1mstringfix\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) stringfix.c -o stringfix
	@$(STRIP) stringfix

../$(EGGEXEC): build_msg $(eggdrop_objs) $(XREQS) compatability
	@echo ""
	@echo "Linking wraith... $(EGGBUILD)"
	@echo ""
	@touch mod/mod.xlibs
	@$(LD) -o ../$(EGGEXEC) $(eggdrop_objs) $(MODOBJS) $(XLIBS) compat/*.o `cat mod/mod.xlibs`
	@$(STRIP) ../$(EGGEXEC)
	@echo "Successful compile: $(EGGEXEC)"
	@echo ""

$(EGGEXEC): stringfix ../$(EGGEXEC)

clean:
	@rm -f .depend *.o *~ _*.c


build_msg:
	@echo "[*] Compiling core components"


compatability:
	+@cd compat && $(MAKE_GENERIC) compat
	@echo "---------- Yeah! that's the compiling, now the linking! ----------"

eggdrop.h:
	@echo "You do not have the eggdrop source!"
	@exit 1

include ./.deps/includes

.SUFFIXES:
.SUFFIXES: .c .h .o

.c.o: stringfix
	@echo -e "Compiling: \033[1m`basename $< .c`\033[0m"
	@./stringfix $< _$< || cp -f $< _$<
	@source='$<' object='$@' depfile='.deps/$*.Po' tmpdepfile='.deps/$*.TPo' depmode=gcc3 $(depcomp) \
	$(CC) $(CFLAGS) $(CPPFLAGS) -c _$<  -o `basename $< .c`.o
#        $(COMPILE) -c `test -f '$<' || echo '$(srcdir)/'`$<


#safety hash

