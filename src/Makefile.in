# Makefile for src/

SHELL = @SHELL@
top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

@SET_MAKE@

CC = @CC@
LD = @CC@
STRIP = @STRIP@
CFLAGS = @CFLAGS@ -I.. -I$(top_srcdir) -I$(top_srcdir)/pack @DEFS@ $(CFLGS)
CPPFLAGS = @CPPFLAGS@

eggdrop_objs = auth.o bg.o botcmd.o botmsg.o botnet.o \
chanprog.o cmds.o config.o core_binds.o crypt.o dcc.o dccutil.o debug.o \
dns.o egg_timer.o flags.o main.o mem.o misc.o misc_file.o modules.o net.o \
rfc1459.o settings.o tcl.o tcldcc.o tclhash.o tclmisc.o \
tcluser.o userent.o userrec.o users.o

MAKE_GENERIC = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' \
'STRIP=$(STRIP)' 'CFLGS=$(CFLGS)'

blah:
	@echo ""
	@echo "Use the build script."
	@echo ""

makehelp: makehelp.c
	@echo -e "Compiling: \033[1mmakehelp\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) makehelp.c -o makehelp
	@$(STRIP) makehelp

sorthelp: sorthelp.c
	@echo -e "Compiling: \033[1msorthelp\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) sorthelp.c -o sorthelp
	@$(STRIP) sorthelp

makesettings: makesettings.c
	@echo -e "Compiling: \033[1mmakesettings\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) makesettings.c -o makesettings
	@$(STRIP) makesettings

stringfix: stringfix.c main.h ../config.h ../pack/pack.cfg eggdrop.h
	@echo -e "Compiling: \033[1mstringfix\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) -I$(top_srcdir)/pack $(CPPFLAGS) stringfix.c -o stringfix
	@$(STRIP) stringfix

../$(EGGEXEC): build_msg $(eggdrop_objs) $(XREQS) compatability
	@echo ""
	@echo "Linking wraith... $(EGGBUILD)"
	@echo ""
	@touch mod/mod.xlibs
	@$(LD) -o ../$(EGGEXEC) $(eggdrop_objs) $(MODOBJS) $(XLIBS) compat/*.o `cat mod/mod.xlibs`
	@$(STRIP) ../$(EGGEXEC)
	@echo "Successful compile: $(EGGEXEC)"
	@echo ""

$(EGGEXEC): stringfix ../$(EGGEXEC)

clean:
	@rm -f .depend *.o *~ _*.c

depleaf:
	$(CC) $(CFLAGS) $(CPPFLAGS) -DLEAF -MM $(srcdir)/*.c > .depend

dephub:
	$(CC) $(CFLAGS) $(CPPFLAGS) -DHUB -MM $(srcdir)/*.c > .depend


build_msg:
	@echo "[*] Compiling core components"


main.o: stringfix
	@./stringfix main.c _main.c || cp -f main.c _main.c
	@echo -e "Compiling: \033[1mmain\033[0m"
	@$(CC) $(CFLAGS) -I$(top_srcdir) $(CPPFLAGS) '-DCCFLAGS="$(CC) $(CFLAGS) $(CPPFLAGS)"' \
	'-DLDFLAGS="$(LD)"' '-DSTRIPFLAGS="$(STRIP)"' -c $(srcdir)/_main.c -o main.o

compatability:
	+@cd compat && $(MAKE_GENERIC) compat
	@echo "---------- Yeah! that's the compiling, now the linking! ----------"

eggdrop.h:
	@echo "You do not have the eggdrop source!"
	@exit 1

.SUFFIXES:
.SUFFIXES: .c .h .o


.c.o: stringfix
	@./stringfix $< _$< || cp -f $< _$<
	@echo -e "Compiling: \033[1m`basename $< .c`\033[0m"
	@$(CC) $(CFLAGS) $(CPPFLAGS) -c _$< -o `basename $< .c`.o

#safety hash
auth.o: auth.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h chan.h users.h compat/compat.h compat/inet_aton.h \
 compat/inet_ntop.h ../src/main.h compat/snprintf.h  compat/memset.h \
 compat/memcpy.h compat/strcasecmp.h compat/strftime.h
bg.o: bg.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h
botcmd.o: botcmd.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h tandem.h modules.h mod/modvals.h
botmsg.o: botmsg.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h tandem.h
botnet.o: botnet.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h tandem.h
chanprog.o: chanprog.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h modules.h mod/modvals.h
cmds.o: cmds.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 tandem.h modules.h mod/modvals.h help.h 
config.o: config.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h chan.h users.h compat/compat.h compat/inet_aton.h \
 compat/inet_ntop.h ../src/main.h compat/snprintf.h  compat/memset.h \
 compat/memcpy.h compat/strcasecmp.h compat/strftime.h
core_binds.o: core_binds.c stringfix main.h ../config.h salt.h eggdrop.h proto.h \
 ../lush.h misc_file.h compat/compat.h compat/inet_aton.h \
 compat/inet_ntop.h ../src/main.h compat/snprintf.h  compat/memset.h \
 compat/memcpy.h compat/strcasecmp.h compat/strftime.h
crypt.o: crypt.c stringfix main.h ../config.h salt.h eggdrop.h proto.h \
 ../lush.h misc_file.h compat/compat.h compat/inet_aton.h \
 compat/inet_ntop.h ../src/main.h compat/snprintf.h  compat/memset.h \
 compat/memcpy.h compat/strcasecmp.h compat/strftime.h
dcc.o: dcc.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 modules.h mod/modvals.h tandem.h 
dccutil.o: dccutil.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h modules.h mod/modvals.h tandem.h
debug.o: debug.c stringfix main.h ../config.h conf.h eggdrop.h \
 proto.h ../lush.h misc_file.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h
dns.o: dns.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 dns.h
egg_timer.o: egg_timer.c egg_timer.h  stringfix main.h ../config.h salt.h eggdrop.h proto.h \
 ../lush.h misc_file.h compat/compat.h compat/inet_aton.h \
 compat/inet_ntop.h ../src/main.h compat/snprintf.h  compat/memset.h \
 compat/memcpy.h compat/strcasecmp.h compat/strftime.h
flags.o: flags.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h
main.o: main.c stringfix main.h build.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 modules.h mod/modvals.h tandem.h  egg_timer.h
match.o: match.c stringfix ./main.h
mem.o: mem.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 mod/modvals.h
misc.o: misc.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 stat.h 
misc_file.o: misc_file.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h stat.h
modules.o: modules.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h modules.h mod/modvals.h tandem.h
net.o: net.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 egg_timer.h
rfc1459.o: rfc1459.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h
settings.o: settings.c stringfix main.h ../config.h conf.h eggdrop.h \
 proto.h ../lush.h misc_file.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h
tcl.o: tcl.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h
tcldcc.o: tcldcc.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h tandem.h modules.h mod/modvals.h
tclhash.o: tclhash.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h match.c
tclmisc.o: tclmisc.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h modules.h mod/modvals.h tandem.h 
tcluser.o: tcluser.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h tandem.h
userent.o: userent.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h
userrec.o: userrec.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h \
 proto.h ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h \
 users.h compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h \
 compat/snprintf.h compat/memset.h compat/memcpy.h compat/strcasecmp.h \
 compat/strftime.h modules.h mod/modvals.h tandem.h
users.o: users.c stringfix main.h ../config.h conf.h lang.h eggdrop.h flags.h proto.h \
 ../lush.h misc_file.h cmdt.h tclegg.h tclhash.h chan.h users.h \
 compat/compat.h compat/inet_aton.h compat/inet_ntop.h ../src/main.h compat/snprintf.h \
 compat/memset.h compat/memcpy.h compat/strcasecmp.h compat/strftime.h \
 modules.h mod/modvals.h tandem.h

#safety hash
